{% load static %}<!DOCTYPE html>
<html>
  <head>
    <title>Today</title>
    <link rel="stylesheet" href="{% static 'kettles/assignment.css' %}" type="text/css" media="screen,projection">
  </head>
  <body>
    <h1>{{todays_date}}</h1>
    <div class="product-list">{% for product in todays_production_day.days_products.all %}
      <h5 class="product {%for tag in product.tags %}{{tag}} {%endfor%}">{{product.item_number}}</h5>{% endfor %}
    </div>
    <div class="kettle-list">{% for k in todays_production_day.kettles.all|dictsort:"kettle_number" %}
      <div class="kettle">
        <p class="kettle-number">{{k.kettle_number}}</p>{% if k.days_products %}
        {% for product in k.days_products.all%}
        {% if product != ''%}
        <h4 class="product {%for tag in product.tags %}{{tag}} {%endfor%}">{{product.item_number}}</h4>{% endif %}
        {% endfor %}
        {% endif %}
      </div>{% endfor %}
    </div>
    <script type="text/javascript" src="{% static 'js/jquery.js'%}"></script>
    <script type="text/javascript" src="{% static 'js/jqueryui.js'%}"></script>
    <script>
      var chatSocket = new WebSocket('ws://' + window.location.host + '/ws/kettles/');
      chatSocket.onopen = function(event) {
        console.log("WebSocket is open now.");
      };
      
      $('.product-list .product').not('.assigned').draggable({
        cursor:'move',
        helper: 'clone',
        classes: {
          "ui-draggable": "dragging-product"
        },
        //- connectToSortable: '.sortable',
        //- start: handleDragStart,
        //- stop: handleProductDrop,
      });
      
      $('.kettle .product').draggable({
        cursor:'move',
        helper: 'clone',
        //- connectToSortable: '.sortable',
        //- start: handleDragStart,
        //- stop: handleProductDrop,
      });
      
      $('.kettle').droppable({
        drop:handleKettleDrop,
      })
      
      $('.product-list').droppable({
        drop:handleProductListDrop,
      })
      
      
      function handleKettleDrop(event, ui){
        var productToDrop = $(ui.draggable);
        var productNumber = productToDrop.text()
        
        var kettleToDropOn = $(event.target).find('.kettle-number').text();
        console.log(kettleToDropOn)
        
        chatSocket.send(JSON.stringify({
            'message': 'updatekettle',
            'product': productNumber,
            'kettle' : kettleToDropOn,
            'date' : '{{todays_production_day.date}}'
        }));
      }
      
      function handleProductListDrop(event, ui){
        var draggedProduct = $(ui.draggable)
        var kettleToRemove = draggedProduct.parent().find('.kettle-number').text();
        console.log()
        
        chatSocket.send(JSON.stringify({
            'message': 'updateproduct',
            'product': draggedProduct.text(),
            'kettle' : kettleToRemove,
            'date' : '{{todays_production_day.date}}'
        }));
      }
    </script>
  </body>
</html>